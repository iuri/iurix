text/html <html><head><meta\ http-equiv=\"Content-Type\"\ content=\"text/html\;\ charset=us-ascii\"></head><body\ style=\"word-wrap:\ break-word\;\ -webkit-nbsp-mode:\ space\;\ line-break:\ after-white-space\;\"\ class=\"\"><div><blockquote\ type=\"cite\"\ class=\"\">Dear\ all,<br\ class=\"\"><div\ class=\"\"><div\ class=\"\">\n\ \ \ \ <div\ class=\"moz-forward-container\">on\ sourceforge\ is\ a\ release\n\ \ \ \ \ \ candidate\ for\ NaviServer\ 4.99.19\ \[1\].<br\ class=\"\">\n\ \ \ \ \ \ <br\ class=\"\">\n\ \ \ \ \ \ Below\ is\ a\ -\ preliminary\ -\ summary\ of\ changes\;\ especially\ the<br\ class=\"\">\n\ \ \ \ \ \ summary\ of\ changes\ in\ the\ modules\ is\ missing.\ In\ case\ you\ have\n\ \ \ \ \ \ more<br\ class=\"\">\n\ \ \ \ \ \ changes\ for\ this\ release,\ please\ commit\ or\ get\ in\ touch\ with\ me.<br\ class=\"\">\n\ \ \ \ \ \ If\ everything\ goes\ well,\ the\ release\ should\ follow\ in\ about\ one\n\ \ \ \ \ \ week.<br\ class=\"\">\n\ \ \ \ \ \ <br\ class=\"\">\n\ \ \ \ \ \ Please\ test\ if\ possible.<br\ class=\"\">\n\ \ \ \ \ \ <br\ class=\"\">\n\ \ \ \ \ \ best\ regards<br\ class=\"\">\n\ \ \ \ \ \ <br\ class=\"\">\n\ \ \ \ \ \ -gustaf<br\ class=\"\">\n\ \ \ \ \ \ \[1\]\n\ \ \ \ \ \ <a\ class=\"moz-txt-link-freetext\"\ href=\"https://sourceforge.net/projects/naviserver/files/naviserver/4.99.19/\">https://sourceforge.net/projects/naviserver/files/naviserver/4.99.19/</a><br\ class=\"\">\n\ \ \ \ \ \ <br\ class=\"\">\n\ \ \ \ \ \ <pre\ class=\"\">=======================================\nNaviServer\ 4.99.19,\ released\ 2019-XX-XX\n=======================================\n\n\ 244\ files\ changed,\ 18221\ insertions(+),\ 7899\ deletions(-)\n\nNew\ Features:\n-------------\n\n\ -\ Bandwidth\ management:\ Limit\ download\ rate\ to\ a\ maximum\ (specified\n\ \ \ as\ kilobytes\ per\ second)\n\n\ \ \ On\ servers\ with\ bad\ internet\ connections,\ it\ is\ possible\ that\ a\ few\n\ \ \ eager\ downloaders\ can\ use\ up\ all\ available\ bandwidth.\ \ NaviServer\n\ \ \ allows\ now\ admins\ and\ developers\ to\ specify\ the\ maximum\ outgoing\n\ \ \ bandwidth\ per\ connection\ or\ per\ connection\ pool.\ The\ rate\ limit\ can\n\ \ \ be\ specified\ per\ connection\ (highest\ weight)\ or\ per\ connection\n\ \ \ thread\ pool\ (second\ highest\ weight)\ or\ per\ network\ driver.\ The\ rate\n\ \ \ limitation\ is\ only\ active,\ when\ writer\ threads\ are\ used.\ Per\n\ \ \ default,\ the\ rate\ limitation\ is\ turned\ off\ (value\ 0).\n\n\ \ \ New\ option\ for\ ns_conn\ to\ query\ set\ the\ per-connection\ limit\n\ \ \ \ \ \ ns_conn\ ratelimit\ ?limit?\n\ \ \ Introspecton\ \"ns_writer\ list\"\ returns\ the\ current\n\ \ \ transferrates\ per\ writer\ job.\n\n\ \ \ Configuration\ option\ for\ connection\ pools:\n\ \ \ \ \ \ ns_param\ connectionratelimit\ ...\n\ \ \ \ \ \ ns_param\ poolratelimit\ ...\n\ \ \ Configuration\ option\ for\ network\ drivers:\n\ \ \ \ \ \ ns_param\ writerratelimit\ ...\n\n\ \ \ Commands\ for\ changing\ the\ rate\ limits\ dynamically:\n\ \ \ \ \ \ \ ns_server\ ?-server\ s?\ ?-pool\ p?\ connectionratelimit\ ?value?\n\ \ \ \ \ \ \ ns_server\ ?-server\ s?\ ?-pool\ p?\ poolratelimit\ ?value?\n\n\n\ -\ Context\ filter\ for\ urlspace:\n\n\ \ \ NaviServer's\ urlspace\ trie\ data\ structure\ used\ for\ various\ purposes\n\ \ \ such\ as\ registering\ methods/URL\ pairs\ for\ procs\ or\ for\ mapping\ of\n\ \ \ requests\ to\ connection\ thread\ pools.\ The\ classical\ trie\ mapping\ for\n\ \ \ e.g.\ \"GET\ /foo/bar/*.html\"\ is\ based\ on\ method\ +\ path\ +\ string\ match\n\ \ \ pattern,\ where\ the\ last\ part\ \"*.html\"\ is\ used\ as\ a\ \"filter\".\n\n\ \ \ The\ new\ version\ of\ NaviServer\ allows\ in\ addition\ to\ the\ string\n\ \ \ based\ glob\ pattern\ so-called\ \"context\ filter\",\ which\ includes\ the\n\ \ \ IP-address\ or\ header\ fields\ in\ the\ matching\ process.\ The\ context\n\ \ \ filters\ are\ applied\ after\ the\ classical\ urlspace\ processing,\ such\n\ \ \ that\ the\ behavior\ is\ fully\ backwards\ compatible.\ The\ context\n\ \ \ filters\ are\ kept\ in\ a\ stable\ order\ (IP\ before\ header-based\ filters,\n\ \ \ specific\ before\ less\ specific)\ such\ that\ the\ behavior\ is\ not\ order\n\ \ \ dependent.\n\n\ \ \ The\ new\ feature\ can\ be\ used\ map\ e.g.\ bots\ or\ certain\ IP\ ranges\ to\n\ \ \ the\ specified\ connection\ pools.\ When\ connection\ pools\ named\ \"bots\"\n\ \ \ and\ \"local\"\ are\ defined,\ one\ can\ use\ the\ following\ mapping\ commands\n\ \ \ to\ map\ incoming\ requests\ to\ the\ specified\ pools.\ Examples\ for\n\ \ \ adding\ urlspace\ mappings\ at\ runtime:\n\n\t\ ns_server\ -pool\ bots\ map\ \"GET\ /*\ \{user-agent\ *bot*\}\"\n\t\ ns_server\ -pool\ bots\ map\ \"GET\ /*\ \{user-agent\ *crawl*\}\"\n\t\ ns_server\ -pool\ bots\ map\ \"GET\ /*\ \{user-agent\ *baidu*\}\"\n\t\ ns_server\ -pool\ bots\ map\ \"GET\ /*\ \{X-NS-ip\ 2a03:2880::/29\}\"\n\n\t\ ns_server\ -pool\ local\ map\ \"GET\ /*\ \{X-NS-ip\ 127.0.0.1\}\"\n\t\ ns_server\ -pool\ local\ map\ \"GET\ /*\ \{X-NS-ip\ 137.208.1.0/16\}\"\n\n\ \ \ Note\ that\ arbitrary\ header\ fields\ can\ be\ used\ for\ the\ mapping,\n\ \ \ containing\ potentially\ some\ glob\ style\ match\ characters.\ The\n\ \ \ special\ header\ field\ \"X-NS-ip\"\ denotes\ IP\ based\ filters,\ which\ can\n\ \ \ be\ provided\ fully\ qualified\ or\ in\ CIDR\ notation\ (denoting\n\ \ \ significant\ bits)\ for\ IPv4\ and\ IPv6.\n\n\n\ -\ Allow\ a\ single\ driver\ to\ listen\ on\ multiple\ IP\ addresses:\n\n\ \ \ This\ feature\ greatly\ simplifies\ setups,\ where\ a\ single\ server\ is\n\ \ \ listening\ on\ multiple\ IP\ addresses\ (e.g.\ IPv4\ and\n\ \ \ IPv6).\ Previously,\ it\ was\ necessary\ to\ define\ separate\ drivers\ for\n\ \ \ these,\ which\ need\ different\ names\ but\ which\ are\ often\n\ \ \ configured\ identically.\ \ Furthermore,\ when\ the\ address\ is\ omitted,\n\ \ \ the\ server\ performs\ a\ lookup\ from\ the\ hostname\ to\ determine\ the\ IP\n\ \ \ address.\ Previously,\ it\ used\ the\ first\ one,\ now\ it\ can\ work\ with\n\ \ \ all\ returned\ addresses.\n\n\ \ \ To\ use\ this\ feature,\ simply\ specify\ the\ configure\ values\ of\n\ \ \ \"address\"\ as\ a\ Tcl\ list\ containing\ multiple\ IP\ addresses.\ The\n\ \ \ change\ is\ fully\ backwards\ compatible,\ old\ configuration\ files\ will\n\ \ \ continue\ to\ work.\n\n\n\ -\ Added\ sending\ of\ multiple\ file\ chunks\ with\ a\ single\ command:\n\ \n\ \ \ \ \ \ ns_writer\ sendfiles\ /list\ of\ filespecs/\n\n\ \ \ Every\ filespec\ is\ a\ dict\ which\ must\ contain\ a\ \"filename\"\ element\n\ \ \ and\ can\ contain\ additionally\ an\ \"-offset\"\ and/or\ a\ \"-size\"\ element.\n\n\ \ \ \ \ \ ns_writer\ submitfiles\ \{\{filename\ /tmp/f1\}\ \{filename\ /tmp/f2\ -offset\ 10\}\}\n\n\ \ \ This\ function\ is\ e.g.\ useful\ for\ video\ streaming\ applications,\n\ \ \ where\ multiple\ video\ file\ chunks\ should\ be\ transferred\ (sometimes)\n\ \ \ concatenated\ in\ a\ single\ chunk.\ Therefore,\ this\ function\ avoids\ the\n\ \ \ necessity\ to\ concatenate\ these\ files\ in\ advance\ (causing\ increased\n\ \ \ latency\ and\ disk\ usage).\n\ \ \n\n\ -\ Added\ per-server\ \"extraheaders\".\ These\ extra\ headers\ fields\ are\n\ \ \ merged\ with\ the\ following\ precedence\ (the\ earlier\ ones\ have\ more\n\ \ \ weight)\n\ \ \ \ \ 1)\ application\ specific\ headers\n\ \ \ \ \ 2)\ per-server\ extra\ headers\n\ \ \ \ \ 3)\ per-driver\ extra\ headers\n\n\ \ \ This\ change\ makes\ it\ possible\ to\ provide\ in\ the\ config\ files\n\ \ \ defaults,\ which\ can\ be\ overwritten\ by\ certain\ pages\ in\ the\n\ \ \ applications.\ Furthermore,\ this\ change\ makes\ it\ easy\ to\ add\n\ \ \ header\ fields\ to\ all\ requests\ of\ a\ virtual\ server\ (e.g.\n\ \ \ Strict-Transport-Security,\ ...)\n\n\n\ -\ Logging\ improvements:\n\n\ \ \ *\ Support\ separate\ access\ logs\ for\ requests\ sent\ via\n\ \ \ \ \ different\ drivers.\n\n\ \ \ \ \ The\ nslog\ module\ accepts\ now\ an\ additional\ parameter\ named\n\ \ \ \ \ \"driver\".\ \ This\ option\ can\ be\ used\ to\ produce\ different\ access\n\ \ \ \ \ logs\ for\ requests\ submitted\ via\ different\ drivers\ to\ sort\ out\n\ \ \ \ \ e.g.\ local\ server\ talk.\ \ Per\ default,\ every\ request\ is\n\ \ \ \ \ logged.\ When\ a\ value\ is\ provided\ for\ this\ parameter,\ only\n\ \ \ \ \ requests\ are\ logged\ in\ this\ log\ file\ when\ these\ come\ from\ a\n\ \ \ \ \ driver\ matching\ the\ provided\ glob\ pattern.\n\ \ \ \ \ \n\ \ \ *\ log-file\ sanitizer:\n\ \ \ \ \ When\ data\ entered\ into\ a\ log\ file\ contains\ special\ characters\n\ \ \ \ \ (e.g.\ \ end\ line\ characters),\ these\ could\ alter\ the\ appearance\ of\n\ \ \ \ \ content\ within\ the\ log\ file.\ Single\ entries\ may\ appear\ as\n\ \ \ \ \ multiple\ entries.\ \ Attackers\ may\ leverage\ log\ forging\ to\ insert\n\ \ \ \ \ fake\ entries\ to\ that\ obfuscate\ malicious\ acts,\ or\ these\ can\n\ \ \ \ \ confuse\ log-file\ analyzers\ to\ avoid\ analysis.\n\n\ \ \ \ \ The\ new\ global\ parameter\ \"sanitizelogfiles\"\ can\ control\ this\n\ \ \ \ \ behavior\ (values\ 0:\ none,\ 1:\ full,\ 2:\ human-friendly\;\ default:\n\ \ \ \ \ 2)\;\n\n\ \ \ *\ Additional\ debugging\ flag\ \"Debug(access)\":\ When\ activated,\ entries\n\ \ \ \ \ of\ the\ access\ log\ are\ mirrored\ in\ the\ system\ log\n\ \ \ \ \ (error.log).\ This\ option\ eases\ tracking\ the\ end\ of\ requests\ in\n\ \ \ \ \ the\ system\ log.\n\n\ \ \ *\ Additional\ debugging\ flag\ \"Debug(writer)\"\ for\ debugging\ of\ writer.\n\n\ \ \ *\ Provided\ access\ to\ request\ AND\ reply\ header\ fields\ via\n\ \ \ \ \ \"extendedheaders\"\ specification\ (in\ \"ns_accesslog\"\ and\ \"nslog\"\n\ \ \ \ \ configuration\ section):\n\n\ \ \ \ \ It\ is\ now\ optionally\ possible\ to\ specify\ the\ header\ fields\ in\ the\n\ \ \ \ \ provided\ \"extendedheaders\"\ list\ with\ a\ prefix\ \"request:\"\ or\n\ \ \ \ \ \"response:\"\ to\ denote\ request\ and\ reply\ header\ fields.\ In\ case,\n\ \ \ \ \ no\ tag\ is\ provided,\ field\ names\ are\ interpreted\ as\ request\ header\n\ \ \ \ \ fields\ (like\ before).\ The\ change\ is\ fully\ backwards\ compatible,\n\n\n\ \ -\ ns_set:\n\n\ \ \ \ *\ Added\ sucommand\ \"ns_set\ imerge\",\ a\ is\ the\ case\ insignificant\n\ \ \ \ \ \ version\ of\ \"ns_set\ merge\".\ This\ option\ is\ useful\ especially\ for\n\ \ \ \ \ \ working\ with\ header\ fields.\n\n\ \ \ \ *\ Added\ subcommand\ \"ns_set\ iupdate\":\ this\ command\ is\ the\ case\n\ \ \ \ \ \ insenstive\ counterpart\ of\ \"ns_set\ update\".\n\n\ \ \ \ *\ Fixed\ \"nsv_set\ a\ b\"\ when\ no\ key\ nor\ array\ exist\n\n\ -\ ns_http:\n\ \ \ *\ Revamp\ of\ ns_http\ and\ related\ supportive\ code.\n\ \ \ *\ Added\ chunked-encoding\ parser\n\ \ \ *\ Tcl\ channel\ support\ for\ body\ (PUT,\ POST)\ and\ for\ result.\n\ \ \ \ \ This\ makes\ it\ possible\ to\ use\ e.g.\ reflected\ Tcl\ channels\n\ \ \ \ \ in\ \"ns_http\".\n\ \ \ \ \ New\ Options\ for\ \"ns_http\ run\"\n\ \ \ \ \ \ \ -\ ?-body_size\ size?\n\ \ \ \ \ \ \ -\ ?-body_chan\ chan?\n\ \ \ \ \ \ \ -\ ?-outputfile\ fn?\n\ \ \ \ \ \ \ -\ ?-outputchan\ chan?\n\ \ \ *\ Make\ clear\ that\ \"ns_http\ run\"\ is\ the\ preferred\ interface\n\ \ \ \ \ (rather\ than\ \"queue\"\ +\ \"wait\")\n\ \ \ *\ Deprecated\ output\ variables\ of\ \"ns_http\ wait\"\ (since\ everything\n\ \ \ \ \ is\ included\ in\ the\ resulting\ dict)\n\n\n\ -\ New\ commands:\n\n\ \ \ *\ ns_asynclogfile:\n\ \ \ \ \ Facility\ for\ thread-safe\ writing\ async\n\ \ \ \ \ log\ files\ of\ various\ kinds\ using\ the\ AsyncWriterThread.\n\ \ \ \ \ Usage\ example:\n\t#\ ...\ at\ startup\n\tset\ fd\ \[ns_asynclogfile\ open\ /tmp/test.log\]\n\t#\ ...\ during\ run\n\tns_asynclogfile\ write\ \$fd\ hello\\n\n\t#\ ...\ at\ shutdown\n\tns_asynclogfile\ close\ \$fd\n\n\ \ \ *\ ns_parsefieldvalue:\n\n\ \ \ \ \ This\ function\ parses\ the\ provided\ field\ value\ (from\ an\ HTTP\n\ \ \ \ \ request\ or\ reply\ header\ field)\ into\ its\ parts\ and\ returns\ these\n\ \ \ \ \ in\ the\ form\ of\ a\ list\ of\ Tcl\ dicts\ or\ a\ single\ Tcl\ dict\ depending\n\ \ \ \ \ on\ parameters.\ The\ syntax\ of\ the\ contents\ of\ these\ header\ fields\n\ \ \ \ \ is\ specified\ in\ RFC\ 7230\ section\ 3.2.6.\n\n\ -\ New\ features\ for\ existing\ commands/subcommands\n\ \n\ \ \ \ *\ Binary\ reform:\ Some\ NaviServer\ commands\ accepted\ previously\n\ \ \ \ \ \ implicitly\ binary\ or\ non-binary\ input,\ some\ commands\ used\n\ \ \ \ \ \ the\ flag\ \"-binary\"\ to\ denote\ the\ differences\ (e.g.\ ns_return).\n\ \ \ \ \ \ For\ a\ more\ uniform\ and\ expectable\ behavior\ binary\ input\ the\n\ \ \ \ \ \ explicit\ option\ \"-binary\"\ flag\ to\ the\ following\ commands:\n\n\tns_base64decode\n\tns_base64encode\n\tns_base64urldecode\n\tns_base64urlencode\n\tns_md5\n\tns_sha1\n\tns_uudecode\n\tns_uuencode\n\tns_crypto::aead::decrypt\ string\ (for\ \"-key\",\ \"-aad\",\ \"-iv\",\ \"input\")\n\tns_crypto::aead::encrypt\ string\ (for\ \"-key\",\ \"-aad\",\ \"-iv\",\ \"input\")\n\tns_crypto::eckey\ import\ (\"-string\")\n\tns_crypto::eckey\ sharedsecret\ (\"pubkey\")\n\tns_crypto::hmac\ add\ (for\ \"message\")\n\tns_crypto::hmac\ new\ (for\ \"key\")\n\tns_crypto::hmac\ string\ (for\ \"key\",\ \"message\")\n\tns_crypto::md\ add\ (for\ \"message\")\n\tns_crypto::md\ hkdf\ (for\ \"-salt\"\ \"-secret\"\ \"-info\")\n\tns_crypto::md\ string\ (for\ \"message\")\n\tns_crypto::md\ vapidsign\ (for\ \"message\")\n\tns_crypto::scrypt\ (for\ \"-salt\"\ \"-secret\")\n\n\ \ \ \ Note\ that\ this\ option\ is\ not\ fully\ backward\ compatible.\ Early\n\ \ \ \ versions\ of\ \"ns_sha1\"\ were\ expecting\ always\ non-binary\ input,\ some\n\ \ \ \ new\ version\ assumed\ binary\ input.\ The\ new\ version\ is\ now\ more\n\ \ \ \ compatible\ with\ AOLserver\ and\ older\ NaviServer\ versions.\n\n\ \ \ \ *\ \"ns_server\ threads\"\ reports\ now\ how\ often\ a\ thread\ of\ this\ pool\n\ \ \ \ \ \ was\ started.\ \ This\ statistic\ can\ help\ to\ identify\n\ \ \ \ \ \ installations,\ where\ threads\ are\ started\ and\ stopped\ in\ a\ too\n\ \ \ \ \ \ eager\ fashion.\n\ \ \ \ *\ \"ns_server....\ stats\":\ added\ \"sendbodysize\"\ and\ \"replybodysize\"\n\ \ \ \ \ \ to\ the\ dict\ of\ the\ per-pool\ statistics.\n\ \ \ \ *\ \"ns_server\ ...\ connectionratelimit\ ?value?\":\ Query\ or\ set\n\ \ \ \ \ \ \ the\ default\ per-connection\ rate\ limit.\n\ \ \ \ *\ \"ns_server\ ...\ poolratelimit\ ?value?\":\ Query\ or\ set\n\ \ \ \ \ \ \ the\ pool\ connection\ rate\ limit.\n\ \ \ \ *\ \"ns_writer\ list\"\ returns\ now\ the\ current\ transferrates\ per\n\ \ \ \ \ \ writer\ job.\n\ \ \ \ \ \ \n\ \ \ \ *\ \"ns_writer\ submitfile\ -offset\ X\ -size\ Y\"\ and\ \"ns_writer\ size\ X\"\n\ \ \ \ \ \ accept\ now\ memory\ units,\ the\ option\ ?-driver\ driver?\ was\ added\n\ \ \ \ \ \ to\ the\ \"ns_writer\"\ subcommands\ \"size\",\ and\ \"streaming\"\n\ \ \ \ \ \ (defaulting\ to\ the\ current\ driver).\n\ \ \ \ \ \ \n\ \ \ \ \ \ One\ can\ now\ write\n\ \ \ \ \ \ \ \ \ \ \ ns_writer\ size\ 150KB\n\ \ \ \ \ \ \ instead\ of\n\ \ \ \ \ \ \ \ \ \ \ ns_writer\ size\ nssock\ \[expr\ 150*1024\]\n\n\n\n\nPerformance\ Improvements:\n-------------------------\n\n\n\n\n\nBug\ Fixes:\n----------\n\n\ \ -\ Blueprint\ serializer:\ moved\ serialized\ objects\ in\ the\ blueprint\n\ \ \ \ after\ the\ namespace\ imports\ and\ ensemble\ recreators\ since\n\ \ \ \ constructors\ can\ call\ functions\ depending\ on\ it.\n\n\ \ -\ Include\ *xml*\ and\ *json*\ in\ non-binary\ MIME\ types.\ Note\ that\n\ \ \ \ there\ is\ no\ exact\ definition,\ what\ MIME\ types\ are\ exactly.\n\n\ \ -\ nslog:\n\ \ \ \ *\ Abort\ in\ error\ situation\ with\ an\ error\ message\ instead\ of\ crashing\n\ \ \ \ *\ Added\ server\ name\ in\ log\ entries\ to\ make\ it\ easier\ to\ distinguish\n\ \ \ \ \ \ messages\ per-server\ during\ bootup\n\n\ \ -\ Range\ requests:\n\ \ \ \ *\ Fixed\ potential\ problem\ with\ too\ many\ non-contiguous\ byte\ ranges\n\ \ \ \ *\ Don't\ silently\ ignore\ invalid\ syntax\ of\ range\ requests\n\n\ \ -\ Improved\ handling\ of\ already\ closed\ connections\ (data\ delivery\ was\n\ \ \ \ already\ delegated\ to\ writer\ threads,\ but\ driver\ still\ wants\ to\n\ \ \ \ return\ data\ directly\;\ this\ could\ happen\ in\ error\ situations)\n\n\ \ -\ connchan:\n\ \ \ \ *\ Fixed\ potential\ invalid\ reads\ in\ (error)\ cases,\ where\n\ \ \ \ \ \ LogConnchanDebug\ is\ enabled\ and\ the\ callback\ is\ deleted\ during\ a\n\ \ \ \ \ \ Tcl_Eval().\n\ \ \ \ *\ Fixed\ potential\ problem,\ where\ call\ to\ Tcl_Eval()\ might\ clean\n\ \ \ \ \ \ structures\ used\ in\ the\ callback\ handler\n\n\ \ -\ Make\ sure,\ memory\ allocated\ by\ Tcl\ is\ returned\ by\ Tcl\ (important,\n\ \ \ \ when\ NaviServer\ is\ compiled\ with\ -DSYSTEM_MALLOC)\n\n\ \ -\ Fixed\ Tcl\ argument\ parsing\ of\ \"ns_roll\",\ \"ns_fmttime\",\ \n\ \ \ \ \"nsv_bucket\"\ and\ \"ns_critsec\ eval\".\n\n\ \ -\ Fixed\ bug\ in\ \"nsv_set\ -default\"\ overwriting\ pre-existing\ values\n\n\ \ -\ Fixed\ potential\ crashes\ in\ (desperate)\ error\ situations,\ where\ the\n\ \ \ \ connection\ was\ already\ closed.\n\ \n\ \ -\ Fixed\ leaking\ tmp\ file,\ when\ writerstraming\ is\ activated\ and\n\ \ \ \ streaming\ HTML\ output\ is\ used.\ This\ bug\ could\ appear,\ when\n\ \ \ \ \"writerstreaming\"\ is\ turned\ on\ in\ the\ config\ file\ (default\ off).\n\ \ \ \ See\ also:\ <a\ class=\"moz-txt-link-freetext\"\ href=\"https://sourceforge.net/p/naviserver/mailman/naviserver\">https://sourceforge.net/p/naviserver/mailman/naviserver</a>-\n\tdevel/thread/dd508519-1262-bd91-288a-fa30a7634224%40digital-\n\t<a\ href=\"http://concepts.com/#msg36794472\"\ class=\"\">concepts.com/#msg36794472</a>\n\n\ \ -\ Made\ table\ used\ for\ enumeration\ values\ for\ Ns_ObjvIndex\ static.\n\ \ \ \ Background:\ This\ is\ a\ fix\ for\ a\ tricky\ Tcl_Obj\ sharing\ bug\n\ \ \ \ triggered\ by\ the\ usage\ of\ C-level\ IndexObjs\ based\ on\ volatile\n\ \ \ \ tables.\ Consider\ the\ following\ example:\n\n\ \ \ \ \ \ \ proc\ foo\ \{x\}\ \{\n\ \ \ \ \ \ \ \ \ \ return\ \[bar\ -value\ x\ ...\]\n\ \ \ \ \ \ \ \}\n\n\ \ \ \ The\ Tcl_Obj\ \"x\"\ is\ shared\ as\ name\ of\ argument\ and\ as\ a\ value\ of\n\ \ \ \ the\ non-positional\ parameter\ \"-value\".\ When\ bar\n\ \ \ \ (e.g.\ C-implemented)\ uses\ Tcl_GetIndexFromObj*()\ to\ lookup\ \"x\"\ in\n\ \ \ \ a\ table\ of\ options,\ which\ is\ volatile,\ the\ involved\ Tcl_Obj\ will\n\ \ \ \ be\ converted\ to\ an\ indexObj.\n\n\ \ \ \ On\ a\ call\ with\ wrong\ number\ of\ arguments(\ e.g.\"foo\ 1\ 2\ 3\"),\ Tcl\n\ \ \ \ will\ try\ to\ give\ a\ nice\ error\ message,\ saying\ that\ \"foo\ x\"\ can\ be\n\ \ \ \ called\ only\ with\ one\ argument.\ When\ printing\ argument\ \"x\",\ it\ sees\n\ \ \ \ that\ \"x\"\ is\ an\ indexObj,\ and\ for\ these\ kinds\ of\ objects,\ \"x\"\ might\n\ \ \ \ be\ an\ abbreviated\ version\ of\ a\ full\ name.\ Since\ the\ table\ behind\n\ \ \ \ the\ indexObj\ is\ in\ the\ case\ above\ volatile,\ a\ crash\ might\ happen.\n\n\ \ -\ Added\ API\ call\ Ns_SockInErrorState()\ since\ SSL_shutdown()\ must\ not\n\ \ \ \ be\ called\ if\ a\ previous\ fatal\ error\ has\ occurred\ on\ a\ connection\n\ \ \ \ i.e.\ if\ SSL_get_error()\ has\ returned\ SSL_ERROR_SYSCALL\ or\n\ \ \ \ SSL_ERROR_SSL.\n\n\ \ -\ Provided\ local\ buffers\ for\ OpenSSL\ ERR_error_string\ handling\ to\n\ \ \ \ avoid\ potential\ race\ conditions\ (OpenSSL\ keeps\ otherwise\ error\n\ \ \ \ messages\ in\ static\ memory).\n\n\ \ -\ Crypto\ support:\n\ \ \ \ *\ New\ feature:\ scrypt\ Password-Based\ Key\ Derivation\ Function\ (RFC\ 7914)\n\n\ \ \ \ \ \ The\ scrypt\ function\ is\ a\ modern\ replacement\ for\ crypt\ and\ bcrypt\n\ \ \ \ \ \ and\ derives\ secret\ keys\ from\ a\ secret\ string.\ It\ is\ based\ on\n\ \ \ \ \ \ memory-\ hard\ functions,\ which\ offer\ added\ protection\ against\n\ \ \ \ \ \ attacks\ using\ custom\ hardware\ and\ GPU\ arrays.\n\n\ \ \ \ \ \ The\ function\ requires\ the\ compilation\ of\ NaviServer\ against\n\ \ \ \ \ \ OpenSSL\ 3.0\ or\ newer\ (not\ yet\ released)\n\n\ \ \ \ \ \ Example\ from\ RFC\ 7914:\n\t%\ ::ns_crypto::scrypt\ -secret\ \"password\"\ -salt\ NaCl\ -n\ 1024\ -r\ 8\ -p\ 16\n\tfdbabe1c9d3472007856e7190d01e9fe7c6ad7cbc8237830e77376634b373162\n\t2eaf30d92e22a3886ff109279d9830dac727afb94a83ee6d8360cbdfa2cc0640\n\n\ \ \ \ \ *\ \"ns_md\"\ and\ \"ns_hmac\":\ added\ flag\ \"-encoding\"\n\n\ \ \ \ \ *\ Added\ options\ \"-passphrase\"\ to\ all\ \"ns_crypto\"\ commands\n\ \ \ \ \ \ \ accepting\ a\ PEM\ file.\ In\ principle,\ every\ PEM\ file\ can\ be\n\ \ \ \ \ \ \ protected\ by\ a\ pass\ phrase.\n\n\ \ \ \ \ *\ Signing\ and\ verifying\ signatures:\ \"::ns_crypto::md\ string\"\ can\n\ \ \ \ \ \ \ be\ used\ for\ signing\ and\ verifying\ of\ cryptgraphic\ signatures:\n\n\t%\ set\ sig\ \[::ns_crypto::md\ string\ \\\n\t\t\ \ \ \ \ -digest\ sha1\ \\\n\t\t\ \ \ \ \ -encoding\ binary\ \\\n\t\t\ \ \ \ \ -sign\ /usr/local/src/naviserver/myprivate.pem\ \\\n\t\ \ \ \ \ \ \ \ \ \ \ \ \ \"abcdefghijklmnopqrstuxvwxyz\\n\"\]\n\n\t%\ set\ vfy\ \[::ns_crypto::md\ string\ \\\n\t\t\ \ \ \ \ -digest\ sha1\ \\\n\t\t\ \ \ \ \ -verify\ /usr/local/src/naviserver/myprivate.pem\ \\\n\t\t\ \ \ \ \ -signature\ \$sig\ \\\n\t\t\ \ \ \ \ \"abcdefghijklmnopqrstuxvwxyz\\n\"\]\n\t\t\ \ \ \ \ \n\ \ -\ nscgi:\n\ \ \ \ *\ ...\n\n\nDocumentation\ improvements:\n---------------------------\n\n\ -\ Improved\ cross\ references\ between\ man\ pages\n\ -\ Added\ documentation\ to\ undocumented\ flags\n\ -\ Added\ more\ example\n\ -\ Improved\ spelling\n\ \n\ -\ The\ following\ 48\ man\ pages\ were\ updated\ since\ the\ last\ release:\n\ \n\ \ \ \ \ \ \ \ admin-db.man,\ admin-install.man,\ admin-maintenance.man,\n\ \ \ \ \ \ \ \ admin-tuning.man,\ commandlist.man,\ ns_adp.man,\ ns_adp_ctl.man,\n\ \ \ \ \ \ \ \ ns_adp_info.man,\ ns_adp_parse.man,\ ns_asynclogfile.man,\n\ \ \ \ \ \ \ \ ns_base64.man,\ ns_conn.man,\ ns_connchan.man,\ ns_crypt.man,\n\ \ \ \ \ \ \ \ ns_crypto.man,\ ns_driver.man,\ ns_filestat.man,\ ns_hmac.man,\n\ \ \ \ \ \ \ \ ns_hotp.man,\ ns_http.man,\ ns_job.man,\ ns_locationproc.man,\n\ \ \ \ \ \ \ \ ns_log.man,\ ns_md.man,\ ns_md5.man,\ ns_parsefieldvalue.man,\n\ \ \ \ \ \ \ \ ns_parseheader.man,\ ns_parseurl.man,\ ns_rand.man,\n\ \ \ \ \ \ \ \ ns_register.man,\ ns_return.man,\ ns_server.man,\ ns_set.man,\n\ \ \ \ \ \ \ \ ns_sha1.man,\ ns_sls.man,\ ns_sockcallback.man,\n\ \ \ \ \ \ \ \ ns_sockselect.man,\ ns_tmpnam.man,\ ns_totp.man,\n\ \ \ \ \ \ \ \ ns_urlspace.man,\ ns_uudecode.man,\ ns_uuencode.man,\n\ \ \ \ \ \ \ \ ns_writer.man,\ nsv.man,\ returnstatus-cmds.man,\n\ \ \ \ \ \ \ \ tcl-lib-file.man,\ tcl-libraries.man,\ tcl-overview.man\n\n\nConfiguration\ Changes:\n----------------------\n\n\ -\ Output\ warning\ to\ system\ log,\ when\ NaviServer\ was\ compiled\ without\n\ \ \ zlib\ support,\ but\ the\ config\ file\ request\ compression.\ \ Before,\ the\n\ \ \ compress\ enable\ request\ was\ silently\ ignored,\ giving\ no\ hint,\ why\n\ \ \ compression\ attempts\ of\ a\ developer\ were\ ignored.\n\n\ -\ Sample\ configurations:\n\n\ \ \ \ *\ Documented\ usage\ of\ connection\ pools\ in\ sample\ config\ files.\n\n\ \ \ \ *\ Added\ sample\ entries\ for\ new\ features\ (e.g.\ rate\ limits,\ log\n\ \ \ \ \ \ file\ sanitizer)\n\ \ \ \ \ \ \n\ \ \ \ *\ openacs-config.tcl:\n\n\ \ \ \ \ \ \ .\ Changed\ driver\ installation\ to\ \"global\"\ in\ sample\ configuration\n\t\ file.\ This\ change\ makes\ it\ easier\ for\ site\ admins\ to\ add\n\t\ further\ servers\ (e.g.\ for\ virtual\ hosting).\n\n\ \ \ \ \ \ \ .\ Simplified\ sample\ config\ file\ by\ using\ multiple\ IP\ addresses\n\t\ per\ driver\n\n\ \ \ *\ nsd-config.tcl:\n\n\ \ \ \ \ \ \ .\ Changed\ driver\ installation\ to\ \"global\"\ in\ sample\ configuration\n\t\ file.\ This\ change\ makes\ it\ easier\ for\ site\ admins\ to\ add\n\n\nCode\ Changes:\n-------------\n\n\ -\ Improved\ scalability:\ provide\ different\ locks\ per\ urlspace\ IDs.\n\ \ \n\ -\ Improved\ range\ checking\ for\ Ns_ObjvInt,\ Ns_ObjvLong,\n\ \ \ Ns_ObjvWideInt\ and\ MemUnits:\n\n\ \ \ *\ built-in\ support\ for\ objv\ parser\ This\ eases\ specification\ of\ the\n\ \ \ \ \ C\ API,\ makes\ accepted\ ranges\ clear\ and\ provides\ consistent\ error\n\ \ \ \ \ messages.\ These\ change\ fixes\ several\ potential\ crashes,\ when\ e.g.\n\ \ \ \ \ passed-in\ values\ are\ used\ as\ array-indices\ (crash\ on\ negative\n\ \ \ \ \ numbers)\ or\ where\ the\ values\ were\ casted\ to\ unsigned\ types\ (very\n\ \ \ \ \ high\ unsigned\ values,\ potential\ memory\ alloc\ problems).\n\n\ \ \ \ *\ Fixed\ all\ cases,\ where\ Tcl_GetIntFromObj(),\ Tcl_GetLongFromObj,\n\ \ \ \ \ \ and\ Tcl_GetWideintFromObj\ was\ used\ without\ a\ range\ check.\n\n\n\ -\ Argument\ parser:\ skip\ processing\ of\ optional\ arguments\ when\ the\n\ \ \ number\ of\ provided\ arguments\ is\ equal\ to\ the\ number\ of\ required\n\ \ \ parameters.\n\n\ \ \ Background:\ This\ change\ allows\ a\ fully\ backward\ compatible\ version\n\ \ \ of\ e.g.\ \"ns_md5\ \$foo\",\ no\ matter\ what\ the\ value\ of\ \"\$foo\"\ is,\n\ \ \ although\ the\ new\ version\ of\ \"ns_md5\"\ has\ now\ a\ \"-binary\"\ option.\n\n\n\ -\ Refactored\ low-level\ socket\ I/O:\n\ \ \ *\ All\ driver\ operations\ are\ now\ strictly\ non-blocking\n\ \ \ *\ Use\ same\ infrastructure\ for\ all\ network\ I/O\ operations\n\ \ \ \ \ (driver,\ connchan,\ ns_http,\ ...)\n\ \ \ *\ Rewritten\ socketfile/sendfile\ handling\ (including\ *BSD\ support)\n\ \ \ *\ Improved\ handling\ of\ closed\ and\ detached\ channels,\ e.g.delegated\n\ \ \ \ \ to\ writers\ (new\ macros\ NS_CONN_REQUIRE_CONNECTED,\n\ \ \ \ \ NS_CONN_REQUIRE_OPEN,\ NS_CONN_REQUIRE_CONFIGURED,\n\ \ \ \ \ NS_CONN_REQUIRE_ALL)\n\ \ \ *\ Improved\ protection\ for\ SIGPIPE\ signals.\n\n\ -\ New\ API\ infrastructure:\ Ns_DList\n\ \ \n\ \ \ The\ Ns_DList\ is\ similar\ to\ Tcl_DString,\ but\ operates\ on\ pointers\n\ \ \ instead\ of\ characters.\ Like\ Tcl_DString,\ Ns_DList\ pre-allocates\n\ \ \ some\ data\ and\ extends\ it\ when\ necessary.\ Ns_DList\ structures\ are\n\ \ \ especially\ useful\ alternative\ to\ linked\ lists,\ when\ usually\ data\n\ \ \ is\ added\ to\ the\ end.\ Since\ the\ data\ is\ kept\ as\ a\ dense\n\ \ \ (potentially\ growing)\ array,\ the\ memory\ locality\ is\ much\ better\n\ \ \ than\ with\ linked\ lists,\ resulting\ in\ better\ CPU\ cache\ hit\ rates.\n\n\ -\ Distinguish\ between\ Ns_NormalizePath()\ and\ Ns_NormalizeUrl(),\n\ \ \ where\ the\ first\ is\ for\ the\ file\ system\ and\ the\ latter\ for\ URLs.\n\ \ \ Previously,\ both\ cases\ were\ handled\ identically.\n\n\ \ -\ Function\ pointer\ handling:\n\ \ \ \ *\ Created\ a\ Tcl\ hash\ type\ for\ function\ pointers,\ since\ ANSI/ISO\ C\n\ \ \ \ \ \ forbids\ casting/comparison\ of\ data\ and\ function\ pointers.\ The\n\ \ \ \ \ \ new\ type\ is\ used\ whenever\ a\ hash\ lookup\ is\ performed\ for\ a\n\ \ \ \ \ \ function\ pointer.\n\ \ \ \ *\ Fixed\ all\ other\ occurrences\ of\ such\ comparisons.\n\n\ -\ Regressions\ testing:\n\ \ \ *\ Removed\ false\ positive\n\ \ \ *\ Switch\ to\ testing\ via\ ns_http\ in\ regression\ tests\n\ \ \ \ \ (this\ makes\ it\ as\ well\ possible\ for\ testing\ https\ connections)\n\ \ \ *\ Extended\ tests:\n\ \ \ \ \ +\ Added\ regression\ tests\ for\ \"ns_rand\"\n\ \ \ \ \ +\ Added\ nsssl\ tests\n\ \ \ \ \ +\ Added\ automatic\ certificate\ generation\ for\ test-server\n\ \ \ \ \ \n\ \ \ \ *\ The\ following\ 35\ tests\ were\ added\ or\ extended\ since\ the\ last\ release\n\ \ \ \ \n\ \ \ \ \ \ \ \ adp.test,\ encoding.test,\ http.test,\ http_byteranges.test,\n\ \ \ \ \ \ \ \ http_chunked.test,\ http_keep.test,\ https.test,\ misc.test,\n\ \ \ \ \ \ \ \ ns_adp_compress.test,\ ns_base64.test,\ ns_cache.test,\n\ \ \ \ \ \ \ \ ns_conn.test,\ ns_conn_host.test,\ ns_crypto.test,\n\ \ \ \ \ \ \ \ ns_driver.test,\ ns_hashpath.test,\ ns_hostbyaddr.test,\n\ \ \ \ \ \ \ \ ns_info.test,\ ns_limits.test,\ ns_md5.test,\ ns_nsv.test,\n\ \ \ \ \ \ \ \ ns_pagepath.test,\ ns_parsefieldvalue.test,\ ns_proxy.test,\n\ \ \ \ \ \ \ \ ns_reflow_text.test,\ ns_schedule.test,\ ns_server.test,\n\ \ \ \ \ \ \ \ ns_serverpath.test,\ ns_set.test,\ ns_sha1.test,\n\ \ \ \ \ \ \ \ ns_urlencode.test,\ ns_urlspace.test,\ ns_uuencode.test,\n\ \ \ \ \ \ \ \ ns_writer.test,\ tclconnio.test,\ tclresp.test\n\n\ -\ Improved\ portability:\n\ \ \ *\ improved\ compatibility\ with\ LibreSSL\ (2.7\ and\ 2.9)\n\ \ \ *\ Windows\ changes\ (Many\ thanks\ to\ Andrew\ Piskorski):\n\ \ \ \ \ +\ Fixed\ Ns_LogRoll()\ to\ work\ on\ Windows.\n\ \ \ \ \ +\ WSASend\ receives\ as\ 5th\ argument\ flags,\ but\ not\ a\ pointer\ to\ flags.\n\ \ \ \ \ +\ Improved\ makefiles\n\ \ \ \ \ +\ Updated\ _MSC_VER\ version\ numbers\ to\ include\ Visual\ Studio\ 2019\n\ \ \ \ \ +\ Added\ macro\ NS_INLINE\ to\ achieve\ higher\ portability\ with\ (older?)\n\ \ \ \ \ \ \ Microsoft\ compilers.\n\n\ -\ Added\ warnings\ about\ potential\ misconfiguration\ of\ NaviServer\ \"tcllib\"\n\ \ \ setting\ (Tcl\ written\ NaviServer\ modules)\n\n\ -\ Marked\ compatibility\ wrappers\ Ns_SetThreadServer()\ and\n\ \ \ Ns_SetThreadServer()\ explicitly\ as\ deprecated.\ Use\n\ \ \ Ns_ThreadSetName()\ and\ Ns_ThreadGetName()\ instead.\n\n\ -\ Build-system\n\ \ \ *\ Added\ -DSYSTEM_MALLOC\ to\ default\ compile\ flags.\n\ \ \ *\ Added\ nsssl\ to\ the\ default\ test\ target.\n\ \ \ *\ Require\ RSA\ keys\ of\ size\ 2048:\ newer\ versions\ of\ OpenSSL\ refuse\ to\ work\n\ \ \ \ \ with\ RSA\ keys\ of\ size\ 1024.\n\ \ \ *\ Improved\ alignment\ with\ Tcl's\ current\ .m4\ file\ to\ get\ rid\ of\n\ \ \ \ \ \"-prebind\"\ deprecated\ message\ under\ macOS.\n\ \ \ *\ Improved\ handling\ of\ posix\ thread\ library\ for\ FreeBSD\ and\ OpenBSD\n\n\ -\ Use\ native\ thread_local\ storage\ for\ log\ handling\ when\ available\n\ \ \ (experimental).\n\n\ -\ Improved\ type\ cleanness\ for\ function\ pointers\n\ -\ Improved\ code\ locality\n\ -\ Improved\ error\ messages\n\ -\ Improved\ structure\ packing\n\ -\ Reduced\ variable\ scopes\n\ -\ Added\ missing\ \"extern\"\ declarations\n\ -\ Aligned\ function\ prototypes\n\ -\ Dropped\ potentially\ dangerous\ call\ to\ alloca()\n\ -\ Added\ typedefs\ for\ commonly\ used\ functions\n\ -\ Reduce\ potential\ dangling\ pointer\ dereferences\n\ -\ Aligned\ names\ of\ arguments\ in\ prototype\ with\ function\ definition\n\ -\ Introduced\ use\ attribute-based\ approach\ for\ denoting\n\ \ \ fall\ through\ in\ case\ statements\n\ -\ Adding\ more\ declarations\ for\ PURE\ and\ CONST\ functions\n\ -\ Improved\ configurability\ for\ clang-tidy\n\n\ -\ Fixed\ macro\ name-clash\ with\ PostgreSQL\n\ -\ Improved\ spelling\n\n\n\nModules:\n--------\n\n....\n</pre>\n\ \ \ \ </div>\n\ \ </div>\n\n_______________________________________________<br\ class=\"\">naviserver-devel\ mailing\ list<br\ class=\"\"><a\ href=\"mailto:naviserver-devel@lists.sourceforge.net\"\ class=\"\">naviserver-devel@lists.sourceforge.net</a><br\ class=\"\">https://lists.sourceforge.net/lists/listinfo/naviserver-devel<br\ class=\"\"></div></blockquote></div><br\ class=\"\"></body></html>