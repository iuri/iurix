***************
*** 9,14 ****
      @cvs-id $Id: photo-album-ajaxpa.diff,v 1.1 2009/04/11 15:56:13 hamiltonc Exp $
  } {
      parent_id:integer,notnull
  } -validate {
      valid_parent -requires {parent_id:integer} {
  	if [string equal [pa_is_folder_p $parent_id] "f"] {
--- 9,15 ----
      @cvs-id $Id: photo-album-ajaxpa.diff,v 1.1 2009/04/11 15:56:13 hamiltonc Exp $
  } {
      parent_id:integer,notnull
+     return_url:optional
  } -validate {
      valid_parent -requires {parent_id:integer} {
  	if [string equal [pa_is_folder_p $parent_id] "f"] {
***************
*** 104,110 ****
  	ad_script_abort
      }
  
-     #redirect back to index page with parent_id
-     ad_returnredirect "?folder_id=$parent_id"
      ad_script_abort
  }
--- 105,116 ----
  	ad_script_abort
      }
  
+     # HAM : added return_url
+     if { ![exists_and_not_null return_url] } {
+         #redirect back to index page with parent_id
+         ad_returnredirect "?folder_id=$parent_id"
+     } else {
+         ad_returnredirect $return_url
+     }
      ad_script_abort
  }
