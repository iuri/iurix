***************
*** 9,14 ****
      @cvs-id $Id: photo-album-ajaxpa.diff,v 1.1 2009/04/11 15:56:13 hamiltonc Exp $
  } {
      folder_id:integer,notnull
  } -validate {
      valid_folder -requires {folder_id:integer} {
  	if [string equal [pa_is_folder_p $folder_id] "f"] {
--- 9,15 ----
      @cvs-id $Id: photo-album-ajaxpa.diff,v 1.1 2009/04/11 15:56:13 hamiltonc Exp $
  } {
      folder_id:integer,notnull
+     return_url:optional
  } -validate {
      valid_folder -requires {folder_id:integer} {
  	if [string equal [pa_is_folder_p $folder_id] "f"] {
***************
*** 70,76 ****
      }
      #redirect back to index page with parent_id
  
-     ad_returnredirect "?folder_id=$folder_id"
  
      ad_script_abort
  }
--- 71,83 ----
      }
      #redirect back to index page with parent_id
  
+     # HAM : added return_url
+     if { ![exists_and_not_null return_url] } {
+         #redirect back to index page with parent_id
+         ad_returnredirect "?folder_id=$parent_id"
+     } else {
+         ad_returnredirect $return_url
+     }
  
      ad_script_abort
  }
