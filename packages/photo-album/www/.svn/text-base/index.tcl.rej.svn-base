***************
*** 35,40 ****
  # check for read permission on folder
  ad_require_permission $folder_id read
  
  set user_id [ad_conn user_id]
  set context [pa_context_bar_list $folder_id]
  
--- 35,46 ----
  # check for read permission on folder
  ad_require_permission $folder_id read
  
+ # HAM : AjaxPA
+ # - we need to pass package_id to ajaxpa-include
+ # - turn ajaxpa on/off with a parameter, default to 1 for now
+ set package_id [ad_conn package_id]
+ set use_ajaxpa_p [parameter::get -parameter UseAjaxPa -default 1]
+ 
  set user_id [ad_conn user_id]
  set context [pa_context_bar_list $folder_id]
  
***************
*** 42,48 ****
  db_1row get_folder_info {}
  
  set root_folder_id [pa_get_root_folder]
- set parameter_url_vars [export_url_vars package_id=[ad_conn package_id] return_url=[ad_conn url]]
  
  # to move an album need write on album and write on parent folder
  set move_p [expr $write_p && !($folder_id == $root_folder_id) && $parent_folder_write_p]
--- 48,54 ----
  db_1row get_folder_info {}
  
  set root_folder_id [pa_get_root_folder]
+ set parameter_url_vars [export_url_vars package_id=$package_id return_url=[ad_conn url]]
  
  # to move an album need write on album and write on parent folder
  set move_p [expr $write_p && !($folder_id == $root_folder_id) && $parent_folder_write_p]
