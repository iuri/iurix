***************
*** 13,18 ****
  } {
      photo_id:integer,notnull
      {confirmed_p "f"}
  } -validate {
      valid_photo -requires {photo_id:integer} {
  	if [string equal [pa_is_photo_p $photo_id] "f"] {
--- 13,19 ----
  } {
      photo_id:integer,notnull
      {confirmed_p "f"}
+     return_url:optional
  } -validate {
      valid_photo -requires {photo_id:integer} {
  	if [string equal [pa_is_photo_p $photo_id] "f"] {
***************
*** 44,50 ****
  
      pa_flush_photo_in_album_cache $album_id
      
-     ad_returnredirect "album?album_id=$album_id"
      ad_script_abort
  
  } else {
--- 45,56 ----
  
      pa_flush_photo_in_album_cache $album_id
      
+     # HAM : added return_url
+     if { ![exists_and_not_null return_url] } {
+         ad_returnredirect "album?album_id=$album_id"
+     } else {
+         ad_returnredirect $return_url
+     }
      ad_script_abort
  
  } else {
